<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<title data-react-helmet="true">설치하기 | CodeSquare</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="설치하기 | CodeSquare"><meta data-react-helmet="true" name="description" content="CodeSquare는 군 복무중인 개발자를 위한 통합 개발 플랫폼입니다."><meta data-react-helmet="true" property="og:description" content="CodeSquare는 군 복무중인 개발자를 위한 통합 개발 플랫폼입니다."><meta data-react-helmet="true" property="og:url" content="https://docs.codesquare.space/docs/installation"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.codesquare.space/docs/installation"><link rel="stylesheet" href="/styles.facf550c.css">
<link rel="preload" href="/styles.078848a7.js" as="script">
<link rel="preload" href="/runtime~main.8b982049.js" as="script">
<link rel="preload" href="/main.5f407709.js" as="script">
<link rel="preload" href="/1.85822923.js" as="script">
<link rel="preload" href="/2.7aba0d90.js" as="script">
<link rel="preload" href="/27.b97b3951.js" as="script">
<link rel="preload" href="/28.c86c9de8.js" as="script">
<link rel="preload" href="/935f2afb.7ecd6f8e.js" as="script">
<link rel="preload" href="/17896441.83879e7c.js" as="script">
<link rel="preload" href="/3b8c55ea.52d46a81.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="CodeSquare Logo"><strong class="navbar__title">CodeSquare</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/docs/api/backend/user/sign-up">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/osamhack2020/WEB_CodeSquare_AmongUs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="CodeSquare Logo"><strong class="navbar__title">CodeSquare</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/api/backend/user/sign-up">API</a></li><li class="menu__list-item"><a href="https://github.com/osamhack2020/WEB_CodeSquare_AmongUs" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About CodeSquare</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction">소개</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/installation">설치하기</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/troubleshooting">Troubleshooting</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">설치하기</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="openstack-minimum-requirements"></a>Openstack Minimum Requirements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#openstack-minimum-requirements" title="Direct link to heading">#</a></h2><p>Openstack 공식 문서에 의하면 openstack controller 노드와 compute 노드의 최소 사양은 아래와 같습니다.</p><ul><li>Controller Node: 1 processor, 4 GB memory, and 5 GB storage</li><li>Compute Node: 1 processor, 2 GB memory, and 10 GB storage
Codesquare에서는 1개의 Controller 노드와 2개의 Compute 노드로 Overcloud openstack 환경을 구축하고자 합니다.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="network-configuration"></a>Network Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#network-configuration" title="Direct link to heading">#</a></h2><p>Codesquare는 Google Cloud를 이용하여 Openstack host machine들을 구축할 내부망을 VPC(Virtual Private Cloud) 네트워크를 이용하여 아래와 같이 구축하였습니다.</p><ul><li><strong><code>IP Address Range</code></strong> : 192.168.1.0/24</li><li><strong><code>Gateway IP Address</code></strong> : 192.168.1.1</li><li><strong><code>NAT IP Address</code></strong> : 192.168.1.2</li><li><strong><code>Controller Node</code></strong> : 192.168.1.10</li><li><strong><code>Compute Node 1</code></strong> : 192.168.1.20</li><li><strong><code>Compute Node 2</code></strong> : 192.168.1.25</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="openstack-install"></a>Openstack Install<a aria-hidden="true" tabindex="-1" class="hash-link" href="#openstack-install" title="Direct link to heading">#</a></h2><p>Codesquare는 openstack install automation tool로 devstack을 채택하였습니다.<br>
그리고 install automation을 수행할 machine으로 아래의 구성으로 동일한 3개의 Ubuntu 18.04 instance를 생성하였습니다.</p><ul><li>e2-standard-4(vCPU 4개, 16GB 메모리)</li><li>Intel Skylake </li><li>80GB Standard Persistent Disk</li><li>ubuntu-1804-bionic-v20200923
각각의 instance에 ssh를 통해 접속하여 <code>/etc/network/interfaces</code>를 아래와 같이 개인의 환경과 동일하게 생성해줍니다. 아래의 예는 Codesquare의 Openstack Controller Node의 network interface입니다.<blockquote><p>Ubuntu 18.04 LTS (xenial) 이후의 운영체제에서 아래 설정 파일을 사용하려면 먼저 sudo apt install ifupdown 명령어를 실행해야 합니다.</p></blockquote></li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">auto eth0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">iface eth0 inet static</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    address 192.168.1.10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    netmask 255.255.255.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    gateway 192.168.1.1</span></div></div></div></div></div><p>Openstack 공식 문서에서는 root access 권한을 가진 non-root user를 생성할 것을 권하고 있으므로, 각각의 인스턴스에 대하여 아래와 같이 stack 유저를 생성한 후 root access 권한을 부여해줬습니다.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useradd</span><span class="token plain"> -s /bin/bash -d /opt/stack -m stack</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;stack ALL=(ALL) NOPASSWD: ALL&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tee</span><span class="token plain"> /etc/sudoers.d/stack</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">su</span><span class="token plain"> - stack</span></div></div></div></div></div><p>각각의 node에서 stack 유저 access를 위해 ssh-key를 추가합니다.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> ~/.ssh</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">chmod</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">700</span><span class="token plain"> ~/.ssh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCyYjfgyPazTvGpd8OaAvtU2utL8W6gWC4JdRS1J95GhNNfQd657yO6s1AH5KYQWktcE6FO/xNUC2reEXSGC7ezy+sGO1kj9Limv5vrvNHvF1+wts0Cmyx61D2nQw35/Qz8BvpdJANL7VwP/cFI/p3yhvx2lsnjFE3hN8xRB2LtLUopUSVdBwACOVUmH2G+2BWMJDjVINd2DPqRIA4Zhy09KJ3O1Joabr0XpQL0yt/I9x8BVHdAx6l9U0tMg9dj5+tAjZvMAFfye3PJcYwwsfJoFxC8w/SLtqlFX7Ehw++8RtvomvuipLdmWCy+T9hIkl+gHYE4cS3OIqXH7f49jdJf jesse@spacey.local&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> ~/.ssh/authorized_keys</span></div></div></div></div></div><p>각각의 node에서 devstack의 stable branch 중 가장 up-to-date한 victoria를 clone 해줍니다.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://opendev.org/openstack/devstack -b stable/victoria</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> devstack</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> samples/local.conf ./local.conf</span></div></div></div></div></div><p>이후에는 Controller Node와 Compute Node 각각 다르게 local.conf 파일을 설정하는데, Compute Node1은 CodeSquare의 주요 서비스들을 docker 형태로 서비스 하기 위해 zun 관련 설정들을, Compute Node2는 CodeSquare의 유저들에게 제공해줄 VM들을 관리하기 위해 default로 설정해줍니다.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="openstack-설치-이전-localconf-편집"></a>Openstack 설치 이전 local.conf 편집<a aria-hidden="true" tabindex="-1" class="hash-link" href="#openstack-설치-이전-localconf-편집" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="controller-node"></a>Controller Node<a aria-hidden="true" tabindex="-1" class="hash-link" href="#controller-node" title="Direct link to heading">#</a></h3><p>원하는 편집기로 samples폴더에서 복사한 local.conf로 들어가서, 패스워드 설정을 한 후 그 아래에 다음과 같은 설정값을 입력합니다. 그리고 heat plugin과 zun plugin 관련 설정 또한 추가해줍니다.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">HOST_IP</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">192.168</span><span class="token plain">.1.10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">FIXED_RANGE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">10.4</span><span class="token plain">.128.0/20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">FLOATING_RANGE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">192.168</span><span class="token plain">.1.128/25</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="heat-plugin"></a>heat plugin<a aria-hidden="true" tabindex="-1" class="hash-link" href="#heat-plugin" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_service h-eng h-api h-api-cfn h-api-cw</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_plugin heat https://opendev.org/openstack/heat stable/victoria</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_plugin heat-dashboard https://opendev.org/openstack/heat-dashboard stable/victoria</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="zun-plugin"></a>zun plugin<a aria-hidden="true" tabindex="-1" class="hash-link" href="#zun-plugin" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_plugin zun https://opendev.org/openstack/zun stable/victoria</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_plugin zun-tempest-plugin https://opendev.org/openstack/zun-tempest-plugin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># This below plugin enables installation of container engine on Devstack.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The default container engine is Docker</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_plugin devstack-plugin-container https://opendev.org/openstack/devstack-plugin-container</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># This enables CRI plugin for containerd</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ENABLE_CONTAINERD_CRI</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Optional:  uncomment to enable Kata Container</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ENABLE_KATA_CONTAINERS=True</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># In Kuryr, KURYR_CAPABILITY_SCOPE is `local` by default,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># but we must change it to `global` in the multinode scenario.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KURYR_CAPABILITY_SCOPE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">global</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KURYR_PROCESS_EXTERNAL_CONNECTIVITY</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">False</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_plugin kuryr-libnetwork https://opendev.org/openstack/kuryr-libnetwork stable/victoria</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># install python-zunclient from git</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">LIBS_FROM_GIT</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;python-zunclient&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Optional:  uncomment to enable the Zun UI plugin in Horizon</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_plugin zun-ui https://opendev.org/openstack/zun-ui stable/victoria</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="compute-node"></a>Compute Node<a aria-hidden="true" tabindex="-1" class="hash-link" href="#compute-node" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="compute-node-1"></a>compute node #1<a aria-hidden="true" tabindex="-1" class="hash-link" href="#compute-node-1" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">HOST_IP</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">192.168</span><span class="token plain">.1.20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">FIXED_RANGE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">10.4</span><span class="token plain">.128.0/20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">FLOATING_RANGE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">192.168</span><span class="token plain">.1.128/25</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ENABLE_CONTAINERD_CRI</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_plugin devstack-plugin-container https://opendev.org/openstack/devstack-plugin-container</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_plugin zun https://opendev.org/openstack/zun stable/victoria</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Optional:  uncomment to enable Kata Container</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ENABLE_KATA_CONTAINERS=True</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KURYR_CAPABILITY_SCOPE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">global</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KURYR_PROCESS_EXTERNAL_CONNECTIVITY</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">False</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_plugin kuryr-libnetwork https://opendev.org/openstack/kuryr-libnetwork stable/victoria</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Following is for multi host settings</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">MULTI_HOST</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">SERVICE_HOST</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">192.168</span><span class="token plain">.1.10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">DATABASE_TYPE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">mysql</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">MYSQL_HOST</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$SERVICE_HOST</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">RABBIT_HOST</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$SERVICE_HOST</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ENABLED_SERVICES</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">zun-compute,kuryr-libnetwork,q-agt</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="compute-node-2"></a>compute node #2<a aria-hidden="true" tabindex="-1" class="hash-link" href="#compute-node-2" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">HOST_IP</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">192.168</span><span class="token plain">.1.25</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">FIXED_RANGE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">10.4</span><span class="token plain">.128.0/20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">FLOATING_RANGE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">192.168</span><span class="token plain">.1.128/25</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">DATABASE_TYPE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">mysql</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">MULTI_HOST</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">SERVICE_HOST</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">192.168</span><span class="token plain">.1.10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">MYSQL_HOST</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$SERVICE_HOST</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">RABBIT_HOST</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$SERVICE_HOST</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">GLANCE_HOSTPORT</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$SERVICE_HOST</span><span class="token plain">:9292</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ENABLED_SERVICES</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">n-cpu,q-agt,c-vol,placement-client</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">NOVA_VNC_ENABLED</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">NOVNCPROXY_URL</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;http://</span><span class="token string variable" style="color:rgb(191, 199, 213)">$SERVICE_HOST</span><span class="token string" style="color:rgb(195, 232, 141)">:6080/vnc_lite.html&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">VNCSERVER_LISTEN</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$HOST_IP</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">VNCSERVER_PROXYCLIENT_ADDRESS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$VNCSERVER_LISTEN</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="after-openstack-install"></a>After Openstack Install<a aria-hidden="true" tabindex="-1" class="hash-link" href="#after-openstack-install" title="Direct link to heading">#</a></h2><p>Control Node와 Compute Node의 Openstack Setup이 모두 끝났다면, Controller Node에서 <code>devstack/tools/discover_hosts.sh</code> 스크립트를 실행하여 compute node host를 controller node에 mapping 시켜줍니다.<br>
이후, Controller Node에서 다음 명령어로 compute node가 제대로 mapping 되었는지 확인합니다.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">source</span><span class="token plain"> openrc admin admin  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#openstack env setting</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ zun </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> list  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#compute node1 나타나는지 확인</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ openstack </span><span class="token function" style="color:rgb(130, 170, 255)">host</span><span class="token plain"> list  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#compute node2 나타나는지 확인</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="delete-unnecessary-projects"></a>Delete unnecessary projects<a aria-hidden="true" tabindex="-1" class="hash-link" href="#delete-unnecessary-projects" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ openstack project purge --project alt_demo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ openstack project purge --project invisible_to_admin</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="synchronize-zun-and-virtual-kubelet"></a>Synchronize Zun and Virtual Kubelet<a aria-hidden="true" tabindex="-1" class="hash-link" href="#synchronize-zun-and-virtual-kubelet" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="kubernetes-install"></a>Kubernetes Install<a aria-hidden="true" tabindex="-1" class="hash-link" href="#kubernetes-install" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> update -y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -y apt-transport-https</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -s https://packages.cloud.google.com/apt/doc/apt-key.gpg </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> apt-key </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">chmod</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">777</span><span class="token plain"> /etc/apt/sources.list.d/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;deb https://apt.kubernetes.io/ kubernetes-xenial main&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tee</span><span class="token plain"> /etc/apt/sources.list.d/kubernetes.list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> update -y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -y kubelet kubeadm kubectl kubernetes-cni</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> swapoff -a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tee</span><span class="token plain"> /proc/sys/net/ipv4/ip_forward</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> kubeadm init --pod-network-cidr </span><span class="token number" style="color:rgb(247, 140, 108)">10.4</span><span class="token plain">.128.0/20</span></div></div></div></div></div><p>kubeadm init 중에 process 2379, 2380이 사용중이라며 에러가 난다면 아래처럼 netstat으로 2379, 2380을 사용하는 process를 찾아내어 kill 명령어로 강제종료 시킵니다.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">netstat</span><span class="token plain"> -nlap </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2379</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">kill</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5382</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#In my case, etcd have 5382 as PID</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> kubeadm init --pod-network-cidr </span><span class="token number" style="color:rgb(247, 140, 108)">10.4</span><span class="token plain">.128.0/20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> -p </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$HOME</span><span class="token plain">/.kube</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> -i /etc/kubernetes/amin.conf </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$HOME</span><span class="token plain">/.kube/config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">chown</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable function" style="color:rgb(130, 170, 255)">id</span><span class="token variable" style="color:rgb(191, 199, 213)"> -u</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable function" style="color:rgb(130, 170, 255)">id</span><span class="token variable" style="color:rgb(191, 199, 213)"> -g</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$HOME</span><span class="token plain">/.kube/config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># kubernetes verification</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl version</span></div></div></div></div></div><p>이후 kubectl get pods -A로 모든 네임스페이스의 모든 팟을 찍어보면, coredns가 pending 상태에서 멈춘 것을 확인할 수 있다.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pods -A</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   coredns-5c98db65d4-5jmmv         </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">/1     Pending   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          4h38m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   coredns-5c98db65d4-tqdpj         </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">/1     Pending   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          4h38m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   etcd-master                      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          4h37m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   kube-apiserver-master            </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          4h38m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   kube-controller-manager-master   </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          4h38m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   kube-proxy-n8f76                 </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          4h38m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   kube-scheduler-master            </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          4h37m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span></div></div></div></div></div><p>coredns의 yaml 파일에서 loop를 제외합니다. 다음 명령을 하여 보여지는 yaml 파일에서 loop 항목을 #loop 로 수정합니다.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl edit cm coredns -n kube-system</span></div></div></div></div></div><p>flannel CNI를 설치합니다.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">podsecuritypolicy.policy/psp.flannel.unprivileged created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">clusterrole.rbac.authorization.k8s.io/flannel created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">serviceaccount/flannel created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">configmap/kube-flannel-cfg created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">daemonset.apps/kube-flannel-ds-amd64 created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">daemonset.apps/kube-flannel-ds-arm64 created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">daemonset.apps/kube-flannel-ds-arm created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">daemonset.apps/kube-flannel-ds-ppc64le created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">daemonset.apps/kube-flannel-ds-s390x created</span></div></div></div></div></div><p>이후, coredns가 RUNNING으로 올바르게 뜨는지 확인합니다.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@codesquare-devstack-control:~/openstack-zun$ kubectl get pods -A</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAMESPACE     NAME                                                  READY   STATUS    RESTARTS   AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   coredns-f9fd979d6-j9cv8                               </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          34m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   coredns-f9fd979d6-jzxq9                               </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          34m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   etcd-codesquare-devstack-control                      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          34m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   kube-apiserver-codesquare-devstack-control            </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          34m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   kube-controller-manager-codesquare-devstack-control   </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          34m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   kube-flannel-ds-8mcxf                                 </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          11m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   kube-proxy-78jcw                                      </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          34m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   kube-scheduler-codesquare-devstack-control            </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          34m</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="golang-latest-install"></a>Golang latest install<a aria-hidden="true" tabindex="-1" class="hash-link" href="#golang-latest-install" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ cd /tmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ sudo wget https://golang.org/dl/go1.15.3.linux-amd64.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ sudo tar -xvzf go1.15.3.linux-amd64.tar.gz </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ sudo mv go /usr/local</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ export GOROOT=/usr/local/go</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ export GOPATH=$HOME/go</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ export PATH=$GOPATH/bin:$GOROOT/bin:$PATH</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ source ~/.profile</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="virtual-kubelet-설치-및-node-등록"></a>Virtual-Kubelet 설치 및 node 등록<a aria-hidden="true" tabindex="-1" class="hash-link" href="#virtual-kubelet-설치-및-node-등록" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ git clone https://github.com/virtual-kubelet/openstack-zun</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ cd openstack-zun</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ make build</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack@control:~$ ./bin/virtual-kubelet --provider openstack &gt; /tmp/vk.out 2&gt;&amp;1 &amp;</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/installation.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 소개</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/troubleshooting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Troubleshooting »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#openstack-minimum-requirements" class="table-of-contents__link">Openstack Minimum Requirements</a></li><li><a href="#network-configuration" class="table-of-contents__link">Network Configuration</a></li><li><a href="#openstack-install" class="table-of-contents__link">Openstack Install</a></li><li><a href="#openstack-설치-이전-localconf-편집" class="table-of-contents__link">Openstack 설치 이전 local.conf 편집</a><ul><li><a href="#controller-node" class="table-of-contents__link">Controller Node</a></li><li><a href="#heat-plugin" class="table-of-contents__link">heat plugin</a></li><li><a href="#zun-plugin" class="table-of-contents__link">zun plugin</a></li><li><a href="#compute-node" class="table-of-contents__link">Compute Node</a></li></ul></li><li><a href="#after-openstack-install" class="table-of-contents__link">After Openstack Install</a></li><li><a href="#delete-unnecessary-projects" class="table-of-contents__link">Delete unnecessary projects</a></li><li><a href="#synchronize-zun-and-virtual-kubelet" class="table-of-contents__link">Synchronize Zun and Virtual Kubelet</a><ul><li><a href="#kubernetes-install" class="table-of-contents__link">Kubernetes Install</a></li><li><a href="#golang-latest-install" class="table-of-contents__link">Golang latest install</a></li><li><a href="#virtual-kubelet-설치-및-node-등록" class="table-of-contents__link">Virtual-Kubelet 설치 및 node 등록</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api/backend/user/sign-up">API</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://osam.kr/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OSAM</a></li><li class="footer__item"><a href="https://github.com/osamhack2020/WEB_CodeSquare_AmongUs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 CodeSquare. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.078848a7.js"></script>
<script src="/runtime~main.8b982049.js"></script>
<script src="/main.5f407709.js"></script>
<script src="/1.85822923.js"></script>
<script src="/2.7aba0d90.js"></script>
<script src="/27.b97b3951.js"></script>
<script src="/28.c86c9de8.js"></script>
<script src="/935f2afb.7ecd6f8e.js"></script>
<script src="/17896441.83879e7c.js"></script>
<script src="/3b8c55ea.52d46a81.js"></script>
</body>
</html>